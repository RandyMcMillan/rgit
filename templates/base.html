<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">


<script src="https://bitcoincore.tech/apps/bitcoinjs-ui/lib/bitcoinjs-lib.js"></script>
<script src="https://bundle.run/bip39@3.0.4"></script>
<script src="https://bundle.run/bip32@2.0.6"></script>
<script src="https://bundle.run/buffer@6.0.3"></script>
<script src="https://bundle.run/noble-secp256k1@1.2.14"></script>
<script src="https://bundle.run/browserify-cipher@1.0.1"></script>
<script>
        function computeRawPrivkey( node ) {
                return bitcoinjs.ECPair.fromPrivateKey( node.privateKey, { network: bitcoinjs.networks.mainnet } );
        }
</script>
<script>
        function getPrivkeyHex( backupwords ) {
                var seed = bip39.mnemonicToSeedSync( backupwords );
                var node = bip32.fromSeed( seed );
                var path = "m/44'/1237'/0'/0/0";
                var root = node;
                var child = root.derivePath( path );
                return computeRawPrivkey( child );
        }
</script>
<script>
        function toHexString(byteArray) {
                return Array.from(byteArray, function(byte) {
                        return ('0' + (byte & 0xFF).toString(16)).slice(-2);
                }).join('');
        }
</script>
<script>
        var backupwords = "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon";
        document.write( "your backup words are " + backupwords + "<br><br>" );
        var privKey = getPrivkeyHex( backupwords );
        privKey = privKey.__D.toString( 'hex' );
        var pubKey = nobleSecp256k1.getPublicKey( privKey, true );
        //be aware that not all valid bitcoin pubkeys are valid nostr pubkeys. Valid bitcoin pubkeys include uncompressed pubkeys (that start with 04), compressed pubkeys whose y coordinate is positive (that start with 02), and compressed pubkeys whose y coordinate is negative (that start with 03).
        //Only the ones that start with 02 are valid for nostr, which then allows us to chop off the 02 when storing the pubkey.
        //So if you change this code to generate random pubkeys, be sure to only use ones that have an 02 at the beginning.
        //The pubkeyMinus2 variable is the pubkey created a moment ago but without the 02 at the beginning.
      	var pubKeyMinus2 = pubKey.substring( 2 );
        document.write( "your public key is " + pubKeyMinus2 + "<br><br>" );
</script>

    <title>{% block title %}rgit{% endblock %}</title>
    <link rel="stylesheet" type="text/css" href="/style-{{ crate::GLOBAL_CSS_HASH }}.css" />
    {%- block head -%}{%- endblock %}
</head>

<body>
<header>
    <h1>
        <a href="/" class="no-hover">></a>
        {% block header -%}gnostr : web{%- endblock %}
    </h1>
</header>

{%- block nav -%}
<nav>
    <div>
        <a href="/" class="active">index</a>
    </div>

    <div class="grow"></div>

    <div>
        {%- block extra_nav_links %}{% endblock %}
    </div>
</nav>
{%- endblock -%}

<aside>
    {%- block subnav %}{% endblock %}
</aside>

<main>
    {%- block content %}{% endblock -%}
</main>

<footer>
    generated by <a href="https://git.inept.dev/~doyle/rgit.git/about" target="_blank">rgit</a> v{{ crate::CRATE_VERSION }}
    at {{ time::OffsetDateTime::now_utc()|format_time }}
    in {{ "{:?}"|format(crate::layers::logger::REQ_TIMESTAMP.get().elapsed()) }}
</footer>
</body>
</html>
